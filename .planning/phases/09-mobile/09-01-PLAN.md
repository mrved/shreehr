# Phase 09: Mobile-Friendly Optimization Plan

## Overview

Based on the research audit, this plan prioritizes mobile fixes from critical navigation issues to polish items.

**Test Criteria**: All changes should be tested at 375px width (iPhone SE).

---

## Wave 1: Quick Wins (CSS-Only Fixes)

### 1.1 Make Search Input Responsive

**Problem**: Fixed `w-72` width doesn't adapt to mobile  
**Solution**: Use responsive width  
**Effort**: 5 min

**File**: `src/components/employees/employee-list.tsx`
```diff
- <div className="relative w-72">
+ <div className="relative w-full sm:w-72">
```

**Success**: Search input fills width on mobile, constrained on desktop.

---

### 1.2 Fix LeaveRequestForm Date Grid

**Problem**: Date inputs always side-by-side, cramped on mobile  
**Solution**: Stack on mobile, side-by-side on sm+  
**Effort**: 5 min

**File**: `src/components/leave/leave-request-form.tsx`
```diff
- <div className="grid grid-cols-2 gap-4">
+ <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
```

**Success**: Date inputs stack on mobile (< 640px), side-by-side on larger.

---

### 1.3 Improve Button Touch Targets

**Problem**: Default buttons are h-9 (36px), below 44px minimum  
**Solution**: Add a mobile-friendly size variant  
**Effort**: 10 min

**File**: `src/components/ui/button.tsx`

Add new size variant:
```tsx
size: {
  default: "h-9 px-4 py-2",
  sm: "h-8 rounded-md px-3 text-xs",
  lg: "h-10 rounded-md px-8",
  icon: "h-9 w-9",
+ mobile: "h-11 px-4 py-2", // 44px for touch
},
```

Then in key forms, use `size="mobile"` or make default responsive:
```tsx
// Alternative: make default size responsive
default: "h-11 sm:h-9 px-4 py-2",
```

**Success**: Primary action buttons are 44px on mobile.

---

## Wave 2: Admin Dashboard Mobile Navigation

### 2.1 Add Mobile Header with Hamburger Menu

**Problem**: Admin dashboard sidebar hidden on mobile, no navigation  
**Solution**: Add hamburger menu to header that opens mobile nav  
**Effort**: 30 min

**Files to Modify**:
- `src/components/layout/header.tsx` - Add hamburger button
- `src/components/layout/sidebar.tsx` - Add mobile overlay variant
- `src/app/dashboard/layout.tsx` - Wire up state

**Implementation**:

**Step 1**: Update `header.tsx` to accept mobile nav toggle:
```tsx
interface HeaderProps {
  user: { ... };
  onMenuClick?: () => void;
  showMenuButton?: boolean;
}

export function Header({ user, onMenuClick, showMenuButton = true }: HeaderProps) {
  return (
    <header className="sticky top-0 z-40 flex h-16 ...">
      <div className="flex flex-1 gap-x-4 self-stretch lg:gap-x-6">
        {/* Mobile menu button */}
        {showMenuButton && (
          <button 
            className="lg:hidden -m-2.5 p-2.5 text-gray-700"
            onClick={onMenuClick}
          >
            <Menu className="h-6 w-6" />
          </button>
        )}
        <div className="flex flex-1" />
        ...
      </div>
    </header>
  );
}
```

**Step 2**: Update `sidebar.tsx` to support mobile mode:
```tsx
interface SidebarProps {
  role: string;
  isOpen?: boolean;
  onClose?: () => void;
}

export function Sidebar({ role, isOpen, onClose }: SidebarProps) {
  const pathname = usePathname();
  const filteredNav = navigation.filter((item) => item.roles.includes(role));

  return (
    <>
      {/* Mobile overlay */}
      {isOpen && (
        <div 
          className="fixed inset-0 bg-black/50 z-40 lg:hidden"
          onClick={onClose}
        />
      )}
      
      {/* Sidebar */}
      <div className={cn(
        "fixed inset-y-0 z-50 flex w-64 flex-col transition-transform lg:translate-x-0",
        isOpen ? "translate-x-0" : "-translate-x-full"
      )}>
        {/* Mobile close button */}
        <div className="lg:hidden absolute top-4 right-4">
          <button onClick={onClose} className="p-2">
            <X className="h-6 w-6" />
          </button>
        </div>
        
        <div className="flex grow flex-col gap-y-5 overflow-y-auto border-r border-gray-200 bg-white px-6 pb-4">
          ...existing nav code...
        </div>
      </div>
    </>
  );
}
```

**Step 3**: Update `dashboard/layout.tsx`:
```tsx
"use client"; // Need client for state

import { useState } from "react";
...

export default function DashboardLayout({ children }) {
  const [sidebarOpen, setSidebarOpen] = useState(false);
  ...

  return (
    <div className="min-h-screen bg-gray-50">
      <Sidebar 
        role={session.user.role} 
        isOpen={sidebarOpen}
        onClose={() => setSidebarOpen(false)}
      />
      <div className="lg:pl-64">
        <Header 
          user={session.user}
          onMenuClick={() => setSidebarOpen(true)}
        />
        <main className="p-4 sm:p-6">{children}</main>
      </div>
    </div>
  );
}
```

**Success**: Hamburger menu appears on screens < 1024px, opens slide-out nav.

---

## Wave 3: Table → Card Mobile Views

### 3.1 EmployeeList Mobile Cards

**Problem**: 6-column table unreadable on mobile  
**Solution**: Add card view following expense-list pattern  
**Effort**: 20 min

**File**: `src/components/employees/employee-list.tsx`

Add after the existing table:
```tsx
{/* Desktop Table View */}
<div className="hidden md:block rounded-md border">
  <Table>...existing...</Table>
</div>

{/* Mobile Card View */}
<div className="md:hidden space-y-3">
  {isLoading ? (
    <Card><CardContent className="py-8 text-center">Loading...</CardContent></Card>
  ) : employees.length === 0 ? (
    <Card><CardContent className="py-8 text-center text-gray-500">No employees found</CardContent></Card>
  ) : (
    employees.map((emp) => (
      <Card key={emp.id}>
        <CardContent className="pt-4">
          <div className="flex items-start justify-between">
            <div>
              <Link 
                href={`/dashboard/employees/${emp.id}`}
                className="font-medium text-blue-600 hover:underline"
              >
                {emp.first_name} {emp.last_name}
              </Link>
              <p className="text-sm text-gray-500">{emp.employee_code}</p>
            </div>
            <Badge variant="outline" className={statusColors[emp.employment_status] || ""}>
              {emp.employment_status}
            </Badge>
          </div>
          <div className="mt-3 grid grid-cols-2 gap-2 text-sm">
            <div>
              <span className="text-gray-500">Dept:</span>
              <p>{emp.department?.name || "-"}</p>
            </div>
            <div>
              <span className="text-gray-500">Role:</span>
              <p>{emp.designation?.title || "-"}</p>
            </div>
          </div>
          {emp.personal_email && (
            <p className="mt-2 text-sm text-gray-600 truncate">{emp.personal_email}</p>
          )}
        </CardContent>
      </Card>
    ))
  )}
</div>
```

**Success**: Cards displayed on mobile with key info visible.

---

### 3.2 LeaveRequestsList Mobile Cards

**Problem**: Leave table with 6-7 columns, truncated reason  
**Solution**: Add card view showing full info  
**Effort**: 20 min

**File**: `src/components/leave/leave-requests-list.tsx`

Add mobile view:
```tsx
{/* Desktop Table View */}
<div className="hidden md:block">
  <Table>...existing...</Table>
</div>

{/* Mobile Card View */}
<div className="md:hidden space-y-3">
  {requests.map((req) => (
    <Card key={req.id}>
      <CardContent className="pt-4">
        <div className="flex items-start justify-between">
          <div>
            {showApproval && (
              <>
                <p className="font-medium">{req.employee.first_name} {req.employee.last_name}</p>
                <p className="text-xs text-muted-foreground">{req.employee.employee_code}</p>
              </>
            )}
            <Badge variant="outline" className="mt-1">{req.leave_type.code}</Badge>
          </div>
          {statusBadge(req.status)}
        </div>
        
        <div className="mt-3 text-sm">
          <div className="flex justify-between">
            <span className="text-gray-500">Dates:</span>
            <span>
              {formatDate(req.start_date)}
              {req.start_date !== req.end_date && ` - ${formatDate(req.end_date)}`}
            </span>
          </div>
          <div className="flex justify-between mt-1">
            <span className="text-gray-500">Days:</span>
            <span>{req.days_count}{req.is_half_day && " (half)"}</span>
          </div>
        </div>
        
        <p className="mt-2 text-sm text-gray-600">{req.reason}</p>
        
        {showApproval && req.status === "PENDING" && (
          <div className="flex gap-2 mt-3">
            <Button size="sm" variant="outline" className="flex-1" onClick={() => handleAction(req.id, "approve")}>
              <Check className="h-4 w-4 mr-1 text-green-500" />
              Approve
            </Button>
            <Button size="sm" variant="outline" className="flex-1" onClick={() => {
              const reason = prompt("Rejection reason:");
              if (reason) handleAction(req.id, "reject", reason);
            }}>
              <X className="h-4 w-4 mr-1 text-red-500" />
              Reject
            </Button>
          </div>
        )}
      </CardContent>
    </Card>
  ))}
</div>
```

**Success**: Leave requests readable on mobile with action buttons.

---

### 3.3 PayrollRecordsTable Mobile Cards

**Problem**: 7-column payroll table with salary numbers  
**Solution**: Card view showing key financial info  
**Effort**: 20 min

**File**: `src/components/payroll/payroll-records-table.tsx`

Replace single table with desktop/mobile split:
```tsx
return (
  <div>
    {/* Desktop Table View */}
    <div className="hidden md:block overflow-x-auto">
      <table className="w-full">...existing table...</table>
    </div>

    {/* Mobile Card View */}
    <div className="md:hidden space-y-3">
      {records.map((record) => (
        <Card key={record.id}>
          <CardContent className="pt-4">
            <div className="flex items-start justify-between">
              <div>
                <p className="font-medium">
                  {record.employee.first_name} {record.employee.last_name}
                </p>
                <p className="text-xs text-gray-500">{record.employee.employee_code}</p>
                <p className="text-sm text-gray-600">{record.employee.department.name}</p>
              </div>
              <span className={`text-xs px-2 py-1 rounded ${
                record.status === "CALCULATED" || record.status === "VERIFIED"
                  ? "bg-green-100 text-green-800"
                  : record.status === "ERROR"
                    ? "bg-red-100 text-red-800"
                    : "bg-gray-100"
              }`}>
                {record.status}
              </span>
            </div>
            
            <div className="mt-3 grid grid-cols-3 gap-2 text-center">
              <div>
                <p className="text-xs text-gray-500">Gross</p>
                <p className="font-medium">{formatCurrency(record.gross_salary_paise)}</p>
              </div>
              <div>
                <p className="text-xs text-gray-500">Deductions</p>
                <p className="font-medium text-red-600">{formatCurrency(record.total_deductions_paise)}</p>
              </div>
              <div>
                <p className="text-xs text-gray-500">Net Pay</p>
                <p className="font-semibold text-green-700">{formatCurrency(record.net_salary_paise)}</p>
              </div>
            </div>
            
            <Button
              variant="outline"
              size="sm"
              className="w-full mt-3"
              onClick={() => downloadPayslip(record.employee.id)}
              disabled={downloading === record.employee.id}
            >
              {downloading === record.employee.id ? "Downloading..." : "Download Payslip"}
            </Button>
          </CardContent>
        </Card>
      ))}
    </div>
  </div>
);
```

**Success**: Payroll info clearly displayed in cards with prominent net pay.

---

## Wave 4: Additional Improvements

### 4.1 TeamAttendance Mobile View

**File**: `src/components/attendance/team-attendance.tsx`  
**Effort**: 15 min

Similar pattern - add card view for team attendance showing:
- Employee name
- Today's status (badge)
- Check-in/out times
- Work hours

### 4.2 Responsive Main Padding

**File**: `src/app/dashboard/layout.tsx`
```diff
- <main className="p-6">{children}</main>
+ <main className="p-4 sm:p-6">{children}</main>
```

### 4.3 Attendance Calendar Touch Improvements

**File**: `src/components/attendance/attendance-calendar.tsx`
```diff
- className="h-10 flex items-center justify-center..."
+ className="h-12 sm:h-10 flex items-center justify-center..."
```

---

## Implementation Order

| Phase | Items | Total Effort | Priority |
|-------|-------|--------------|----------|
| Wave 1 | Search input, form grid, button sizes | ~20 min | P2 |
| Wave 2 | Admin mobile navigation | ~30 min | P0 |
| Wave 3 | Employee, Leave, Payroll cards | ~60 min | P1 |
| Wave 4 | Team attendance, polish | ~30 min | P2 |

**Recommended Order**: Wave 2 → Wave 3 → Wave 1 → Wave 4

---

## Testing Checklist

Test each page at **375px width** (Chrome DevTools → iPhone SE):

- [ ] `/dashboard` - Can navigate via hamburger menu
- [ ] `/dashboard/employees` - Cards display, can search
- [ ] `/dashboard/leave` - Cards display, can approve/reject
- [ ] `/dashboard/payroll/[id]` - Cards display, can download payslip
- [ ] `/dashboard/expenses` - Already has cards, verify
- [ ] `/dashboard/loans` - Already has cards, verify
- [ ] `/dashboard/onboarding` - Already has cards, verify
- [ ] All forms - Inputs are full-width, buttons are tappable
- [ ] Sidebar - Opens/closes smoothly, items are tappable

---

## Files to Modify Summary

| File | Changes |
|------|---------|
| `src/app/dashboard/layout.tsx` | Add client state, wire up mobile nav |
| `src/components/layout/header.tsx` | Add hamburger menu button |
| `src/components/layout/sidebar.tsx` | Add mobile overlay mode |
| `src/components/employees/employee-list.tsx` | Add mobile cards, fix search width |
| `src/components/leave/leave-requests-list.tsx` | Add mobile cards |
| `src/components/leave/leave-request-form.tsx` | Fix date grid |
| `src/components/payroll/payroll-records-table.tsx` | Add mobile cards |
| `src/components/ui/button.tsx` | Optional: mobile size variant |

---

## Dependencies

- Import `Card`, `CardContent` in components that don't have them
- Import `Menu`, `X` icons from lucide-react where needed
- No new npm packages required

## Not In Scope

- Dark mode mobile testing (separate phase)
- PWA/offline support
- Mobile-specific gestures (swipe to delete, etc.)
- Native app considerations
