---
phase: 01-foundation
plan: 03
type: execute
wave: 2
depends_on: ["01-01"]
files_modified:
  - src/app/api/employees/route.ts
  - src/app/api/employees/[id]/route.ts
  - src/app/api/departments/route.ts
  - src/app/api/departments/[id]/route.ts
  - src/app/api/designations/route.ts
  - src/app/api/designations/[id]/route.ts
  - src/app/(dashboard)/employees/page.tsx
  - src/app/(dashboard)/employees/new/page.tsx
  - src/app/(dashboard)/employees/[id]/page.tsx
  - src/app/(dashboard)/departments/page.tsx
  - src/components/employees/employee-form.tsx
  - src/components/employees/employee-list.tsx
  - src/components/departments/department-form.tsx
  - src/lib/validations/employee.ts
  - src/lib/validations/organization.ts
autonomous: true

must_haves:
  truths:
    - "Admin can create a new employee with personal info, bank details, PAN, Aadhaar"
    - "Admin can view list of all employees with search and filters"
    - "Admin can edit employee details"
    - "Admin can create and manage departments"
    - "Admin can create and manage designations"
    - "Admin can assign employee to department, designation, and reporting manager"
    - "PII fields (PAN, Aadhaar, bank) are encrypted before storage"
  artifacts:
    - path: "src/app/api/employees/route.ts"
      provides: "Employee list and create API"
      exports: ["GET", "POST"]
    - path: "src/app/api/departments/route.ts"
      provides: "Department CRUD API"
      exports: ["GET", "POST"]
    - path: "src/components/employees/employee-form.tsx"
      provides: "Employee create/edit form"
      min_lines: 150
    - path: "src/lib/validations/employee.ts"
      provides: "Zod schemas for employee validation"
      exports: ["employeeSchema"]
  key_links:
    - from: "src/app/api/employees/route.ts"
      to: "src/lib/encryption.ts"
      via: "encrypt PII before save"
      pattern: "encrypt\\("
    - from: "src/components/employees/employee-form.tsx"
      to: "/api/employees"
      via: "form submission"
      pattern: "fetch.*api/employees"
---

<objective>
Build complete Employee CRUD with organization structure (departments, designations, reporting hierarchy) and PII encryption.

Purpose: Enable admin to manage the core HR data - employees and organizational structure - with proper data protection for sensitive fields.

Output: Working employee management UI, department/designation management, all with encrypted PII storage.
</objective>

<execution_context>
@C:\Users\ved\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\ved\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@prisma/schema.prisma
@src/lib/db.ts
@src/lib/encryption.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create organization structure APIs (Departments, Designations)</name>
  <files>
    src/app/api/departments/route.ts
    src/app/api/departments/[id]/route.ts
    src/app/api/designations/route.ts
    src/app/api/designations/[id]/route.ts
    src/lib/validations/organization.ts
  </files>
  <action>
    Install zod for validation:
    ```bash
    pnpm add zod
    ```

    Create src/lib/validations/organization.ts:
    ```typescript
    import { z } from 'zod';

    export const departmentSchema = z.object({
      name: z.string().min(2, 'Name must be at least 2 characters').max(100),
      code: z.string().min(2, 'Code must be at least 2 characters').max(10).toUpperCase(),
      description: z.string().max(500).optional(),
      isActive: z.boolean().default(true),
    });

    export const designationSchema = z.object({
      title: z.string().min(2, 'Title must be at least 2 characters').max(100),
      level: z.number().int().min(1).max(10).default(1),
      description: z.string().max(500).optional(),
      isActive: z.boolean().default(true),
    });

    export type DepartmentInput = z.infer<typeof departmentSchema>;
    export type DesignationInput = z.infer<typeof designationSchema>;
    ```

    Create src/app/api/departments/route.ts:
    ```typescript
    import { NextRequest, NextResponse } from 'next/server';
    import { auth } from '@/lib/auth';
    import { prisma } from '@/lib/db';
    import { departmentSchema } from '@/lib/validations/organization';

    export async function GET() {
      const session = await auth();
      if (!session?.user) {
        return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });
      }

      const departments = await prisma.department.findMany({
        orderBy: { name: 'asc' },
        include: {
          _count: { select: { employees: true } },
        },
      });

      return NextResponse.json(departments);
    }

    export async function POST(request: NextRequest) {
      const session = await auth();
      if (!session?.user || session.user.role !== 'ADMIN') {
        return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });
      }

      try {
        const body = await request.json();
        const validated = departmentSchema.parse(body);

        const department = await prisma.department.create({
          data: {
            ...validated,
            createdBy: session.user.id,
            updatedBy: session.user.id,
          },
        });

        return NextResponse.json(department, { status: 201 });
      } catch (error) {
        if (error instanceof Error && error.message.includes('Unique constraint')) {
          return NextResponse.json(
            { error: 'Department name or code already exists' },
            { status: 400 }
          );
        }
        return NextResponse.json({ error: 'Invalid data' }, { status: 400 });
      }
    }
    ```

    Create src/app/api/departments/[id]/route.ts:
    ```typescript
    import { NextRequest, NextResponse } from 'next/server';
    import { auth } from '@/lib/auth';
    import { prisma } from '@/lib/db';
    import { departmentSchema } from '@/lib/validations/organization';

    export async function GET(
      request: NextRequest,
      { params }: { params: Promise<{ id: string }> }
    ) {
      const session = await auth();
      if (!session?.user) {
        return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });
      }

      const { id } = await params;
      const department = await prisma.department.findUnique({
        where: { id },
        include: {
          employees: {
            select: { id: true, firstName: true, lastName: true, employeeCode: true },
          },
        },
      });

      if (!department) {
        return NextResponse.json({ error: 'Not found' }, { status: 404 });
      }

      return NextResponse.json(department);
    }

    export async function PUT(
      request: NextRequest,
      { params }: { params: Promise<{ id: string }> }
    ) {
      const session = await auth();
      if (!session?.user || session.user.role !== 'ADMIN') {
        return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });
      }

      const { id } = await params;
      try {
        const body = await request.json();
        const validated = departmentSchema.partial().parse(body);

        const department = await prisma.department.update({
          where: { id },
          data: {
            ...validated,
            updatedBy: session.user.id,
          },
        });

        return NextResponse.json(department);
      } catch (error) {
        return NextResponse.json({ error: 'Invalid data' }, { status: 400 });
      }
    }

    export async function DELETE(
      request: NextRequest,
      { params }: { params: Promise<{ id: string }> }
    ) {
      const session = await auth();
      if (!session?.user || session.user.role !== 'ADMIN') {
        return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });
      }

      const { id } = await params;

      // Check if department has employees
      const employeeCount = await prisma.employee.count({
        where: { departmentId: id },
      });

      if (employeeCount > 0) {
        return NextResponse.json(
          { error: 'Cannot delete department with employees' },
          { status: 400 }
        );
      }

      await prisma.department.delete({ where: { id } });
      return NextResponse.json({ success: true });
    }
    ```

    Create src/app/api/designations/route.ts (similar pattern):
    ```typescript
    import { NextRequest, NextResponse } from 'next/server';
    import { auth } from '@/lib/auth';
    import { prisma } from '@/lib/db';
    import { designationSchema } from '@/lib/validations/organization';

    export async function GET() {
      const session = await auth();
      if (!session?.user) {
        return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });
      }

      const designations = await prisma.designation.findMany({
        orderBy: [{ level: 'asc' }, { title: 'asc' }],
        include: {
          _count: { select: { employees: true } },
        },
      });

      return NextResponse.json(designations);
    }

    export async function POST(request: NextRequest) {
      const session = await auth();
      if (!session?.user || session.user.role !== 'ADMIN') {
        return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });
      }

      try {
        const body = await request.json();
        const validated = designationSchema.parse(body);

        const designation = await prisma.designation.create({
          data: {
            ...validated,
            createdBy: session.user.id,
            updatedBy: session.user.id,
          },
        });

        return NextResponse.json(designation, { status: 201 });
      } catch (error) {
        if (error instanceof Error && error.message.includes('Unique constraint')) {
          return NextResponse.json(
            { error: 'Designation title already exists' },
            { status: 400 }
          );
        }
        return NextResponse.json({ error: 'Invalid data' }, { status: 400 });
      }
    }
    ```

    Create src/app/api/designations/[id]/route.ts:
    ```typescript
    import { NextRequest, NextResponse } from 'next/server';
    import { auth } from '@/lib/auth';
    import { prisma } from '@/lib/db';
    import { designationSchema } from '@/lib/validations/organization';

    export async function GET(
      request: NextRequest,
      { params }: { params: Promise<{ id: string }> }
    ) {
      const session = await auth();
      if (!session?.user) {
        return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });
      }

      const { id } = await params;
      const designation = await prisma.designation.findUnique({
        where: { id },
      });

      if (!designation) {
        return NextResponse.json({ error: 'Not found' }, { status: 404 });
      }

      return NextResponse.json(designation);
    }

    export async function PUT(
      request: NextRequest,
      { params }: { params: Promise<{ id: string }> }
    ) {
      const session = await auth();
      if (!session?.user || session.user.role !== 'ADMIN') {
        return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });
      }

      const { id } = await params;
      try {
        const body = await request.json();
        const validated = designationSchema.partial().parse(body);

        const designation = await prisma.designation.update({
          where: { id },
          data: {
            ...validated,
            updatedBy: session.user.id,
          },
        });

        return NextResponse.json(designation);
      } catch (error) {
        return NextResponse.json({ error: 'Invalid data' }, { status: 400 });
      }
    }

    export async function DELETE(
      request: NextRequest,
      { params }: { params: Promise<{ id: string }> }
    ) {
      const session = await auth();
      if (!session?.user || session.user.role !== 'ADMIN') {
        return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });
      }

      const { id } = await params;

      const employeeCount = await prisma.employee.count({
        where: { designationId: id },
      });

      if (employeeCount > 0) {
        return NextResponse.json(
          { error: 'Cannot delete designation with employees' },
          { status: 400 }
        );
      }

      await prisma.designation.delete({ where: { id } });
      return NextResponse.json({ success: true });
    }
    ```
  </action>
  <verify>
    `pnpm tsc --noEmit` - no TypeScript errors
    Test with curl or API client:
    - POST /api/departments with body {"name": "Engineering", "code": "ENG"}
    - GET /api/departments returns list
  </verify>
  <done>
    Department and Designation CRUD APIs working with validation, auth checks, and audit fields.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create Employee API with PII encryption</name>
  <files>
    src/app/api/employees/route.ts
    src/app/api/employees/[id]/route.ts
    src/lib/validations/employee.ts
  </files>
  <action>
    Create src/lib/validations/employee.ts:
    ```typescript
    import { z } from 'zod';

    // Indian PAN format: 5 letters, 4 digits, 1 letter
    const panRegex = /^[A-Z]{5}[0-9]{4}[A-Z]{1}$/;

    // Indian Aadhaar: 12 digits
    const aadhaarRegex = /^[0-9]{12}$/;

    // IFSC code: 4 letters, 0, 6 alphanumeric
    const ifscRegex = /^[A-Z]{4}0[A-Z0-9]{6}$/;

    export const employeeCreateSchema = z.object({
      // Personal Info
      employeeCode: z.string().min(1).max(20),
      firstName: z.string().min(1).max(100),
      lastName: z.string().min(1).max(100),
      dateOfBirth: z.string().transform((s) => new Date(s)),
      gender: z.enum(['MALE', 'FEMALE', 'OTHER']),
      personalEmail: z.string().email().optional().nullable(),
      workEmail: z.string().email(),
      phone: z.string().min(10).max(15),
      emergencyContact: z.string().max(100).optional().nullable(),
      emergencyPhone: z.string().max(15).optional().nullable(),

      // Address
      currentAddress: z.string().max(500).optional().nullable(),
      permanentAddress: z.string().max(500).optional().nullable(),
      city: z.string().max(100).optional().nullable(),
      state: z.string().max(100).optional().nullable(),
      pincode: z.string().max(10).optional().nullable(),

      // Employment
      dateOfJoining: z.string().transform((s) => new Date(s)),
      status: z.enum(['ACTIVE', 'INACTIVE', 'TERMINATED', 'ON_NOTICE']).default('ACTIVE'),
      probationEndDate: z.string().transform((s) => new Date(s)).optional().nullable(),
      noticePeriodDays: z.number().int().min(0).max(180).default(30),

      // Organization
      departmentId: z.string().optional().nullable(),
      designationId: z.string().optional().nullable(),
      reportingManagerId: z.string().optional().nullable(),

      // Sensitive (will be encrypted)
      panNumber: z.string().regex(panRegex, 'Invalid PAN format').optional().nullable(),
      aadhaarNumber: z.string().regex(aadhaarRegex, 'Invalid Aadhaar format').optional().nullable(),
      bankAccountNumber: z.string().min(9).max(18).optional().nullable(),
      bankIfscCode: z.string().regex(ifscRegex, 'Invalid IFSC format').optional().nullable(),
      bankName: z.string().max(100).optional().nullable(),

      // Statutory
      uanNumber: z.string().max(12).optional().nullable(),
      pfNumber: z.string().max(22).optional().nullable(),
      esiNumber: z.string().max(17).optional().nullable(),
    });

    export const employeeUpdateSchema = employeeCreateSchema.partial().omit({ employeeCode: true });

    export type EmployeeCreateInput = z.infer<typeof employeeCreateSchema>;
    export type EmployeeUpdateInput = z.infer<typeof employeeUpdateSchema>;
    ```

    Create src/app/api/employees/route.ts:
    ```typescript
    import { NextRequest, NextResponse } from 'next/server';
    import { auth } from '@/lib/auth';
    import { prisma } from '@/lib/db';
    import { encrypt, maskPan, maskAadhaar, maskBankAccount } from '@/lib/encryption';
    import { employeeCreateSchema } from '@/lib/validations/employee';

    export async function GET(request: NextRequest) {
      const session = await auth();
      if (!session?.user) {
        return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });
      }

      const searchParams = request.nextUrl.searchParams;
      const search = searchParams.get('search') || '';
      const departmentId = searchParams.get('departmentId');
      const status = searchParams.get('status');
      const page = parseInt(searchParams.get('page') || '1');
      const limit = parseInt(searchParams.get('limit') || '20');

      const where: any = {};

      if (search) {
        where.OR = [
          { firstName: { contains: search, mode: 'insensitive' } },
          { lastName: { contains: search, mode: 'insensitive' } },
          { employeeCode: { contains: search, mode: 'insensitive' } },
          { workEmail: { contains: search, mode: 'insensitive' } },
        ];
      }

      if (departmentId) {
        where.departmentId = departmentId;
      }

      if (status) {
        where.status = status;
      }

      // For non-admin roles, restrict to own data or direct reports
      if (session.user.role === 'EMPLOYEE') {
        where.id = session.user.employeeId;
      } else if (session.user.role === 'MANAGER') {
        where.OR = [
          { id: session.user.employeeId },
          { reportingManagerId: session.user.employeeId },
        ];
      }

      const [employees, total] = await Promise.all([
        prisma.employee.findMany({
          where,
          skip: (page - 1) * limit,
          take: limit,
          orderBy: { firstName: 'asc' },
          include: {
            department: { select: { id: true, name: true } },
            designation: { select: { id: true, title: true } },
            reportingManager: { select: { id: true, firstName: true, lastName: true } },
          },
        }),
        prisma.employee.count({ where }),
      ]);

      // Mask sensitive fields in response
      const maskedEmployees = employees.map((emp) => ({
        ...emp,
        panNumber: emp.panNumber ? maskPan('MASKED') : null,
        aadhaarNumber: emp.aadhaarNumber ? maskAadhaar('MASKED') : null,
        bankAccountNumber: emp.bankAccountNumber ? maskBankAccount('MASKED') : null,
      }));

      return NextResponse.json({
        employees: maskedEmployees,
        pagination: {
          page,
          limit,
          total,
          totalPages: Math.ceil(total / limit),
        },
      });
    }

    export async function POST(request: NextRequest) {
      const session = await auth();
      if (!session?.user || session.user.role !== 'ADMIN') {
        return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });
      }

      try {
        const body = await request.json();
        const validated = employeeCreateSchema.parse(body);

        // Encrypt sensitive fields
        const encryptedData = {
          ...validated,
          panNumber: validated.panNumber ? encrypt(validated.panNumber) : null,
          aadhaarNumber: validated.aadhaarNumber ? encrypt(validated.aadhaarNumber) : null,
          bankAccountNumber: validated.bankAccountNumber ? encrypt(validated.bankAccountNumber) : null,
          createdBy: session.user.id,
          updatedBy: session.user.id,
        };

        const employee = await prisma.employee.create({
          data: encryptedData,
          include: {
            department: { select: { id: true, name: true } },
            designation: { select: { id: true, title: true } },
          },
        });

        return NextResponse.json(employee, { status: 201 });
      } catch (error) {
        console.error('Employee create error:', error);
        if (error instanceof Error && error.message.includes('Unique constraint')) {
          return NextResponse.json(
            { error: 'Employee code or work email already exists' },
            { status: 400 }
          );
        }
        return NextResponse.json({ error: 'Invalid data' }, { status: 400 });
      }
    }
    ```

    Create src/app/api/employees/[id]/route.ts:
    ```typescript
    import { NextRequest, NextResponse } from 'next/server';
    import { auth } from '@/lib/auth';
    import { prisma } from '@/lib/db';
    import { encrypt, decrypt, maskPan, maskAadhaar, maskBankAccount } from '@/lib/encryption';
    import { employeeUpdateSchema } from '@/lib/validations/employee';

    export async function GET(
      request: NextRequest,
      { params }: { params: Promise<{ id: string }> }
    ) {
      const session = await auth();
      if (!session?.user) {
        return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });
      }

      const { id } = await params;

      // Access control
      if (session.user.role === 'EMPLOYEE' && session.user.employeeId !== id) {
        return NextResponse.json({ error: 'Forbidden' }, { status: 403 });
      }

      const employee = await prisma.employee.findUnique({
        where: { id },
        include: {
          department: true,
          designation: true,
          reportingManager: { select: { id: true, firstName: true, lastName: true } },
          directReports: { select: { id: true, firstName: true, lastName: true, employeeCode: true } },
        },
      });

      if (!employee) {
        return NextResponse.json({ error: 'Not found' }, { status: 404 });
      }

      // For admin, decrypt and show masked values; for others, just mask
      const response = {
        ...employee,
        panNumber: employee.panNumber
          ? session.user.role === 'ADMIN'
            ? maskPan(decrypt(employee.panNumber))
            : maskPan('MASKED')
          : null,
        aadhaarNumber: employee.aadhaarNumber
          ? session.user.role === 'ADMIN'
            ? maskAadhaar(decrypt(employee.aadhaarNumber))
            : maskAadhaar('MASKED')
          : null,
        bankAccountNumber: employee.bankAccountNumber
          ? session.user.role === 'ADMIN'
            ? maskBankAccount(decrypt(employee.bankAccountNumber))
            : maskBankAccount('MASKED')
          : null,
        // Include full values only for admin (for editing)
        _sensitive: session.user.role === 'ADMIN' ? {
          panNumber: employee.panNumber ? decrypt(employee.panNumber) : null,
          aadhaarNumber: employee.aadhaarNumber ? decrypt(employee.aadhaarNumber) : null,
          bankAccountNumber: employee.bankAccountNumber ? decrypt(employee.bankAccountNumber) : null,
        } : undefined,
      };

      return NextResponse.json(response);
    }

    export async function PUT(
      request: NextRequest,
      { params }: { params: Promise<{ id: string }> }
    ) {
      const session = await auth();
      if (!session?.user || session.user.role !== 'ADMIN') {
        return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });
      }

      const { id } = await params;

      try {
        const body = await request.json();
        const validated = employeeUpdateSchema.parse(body);

        // Encrypt sensitive fields if provided
        const updateData: any = { ...validated, updatedBy: session.user.id };

        if (validated.panNumber !== undefined) {
          updateData.panNumber = validated.panNumber ? encrypt(validated.panNumber) : null;
        }
        if (validated.aadhaarNumber !== undefined) {
          updateData.aadhaarNumber = validated.aadhaarNumber ? encrypt(validated.aadhaarNumber) : null;
        }
        if (validated.bankAccountNumber !== undefined) {
          updateData.bankAccountNumber = validated.bankAccountNumber ? encrypt(validated.bankAccountNumber) : null;
        }

        const employee = await prisma.employee.update({
          where: { id },
          data: updateData,
          include: {
            department: { select: { id: true, name: true } },
            designation: { select: { id: true, title: true } },
          },
        });

        return NextResponse.json(employee);
      } catch (error) {
        console.error('Employee update error:', error);
        return NextResponse.json({ error: 'Invalid data' }, { status: 400 });
      }
    }

    export async function DELETE(
      request: NextRequest,
      { params }: { params: Promise<{ id: string }> }
    ) {
      const session = await auth();
      if (!session?.user || session.user.role !== 'ADMIN') {
        return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });
      }

      const { id } = await params;

      // Soft delete - set status to TERMINATED
      await prisma.employee.update({
        where: { id },
        data: {
          status: 'TERMINATED',
          dateOfExit: new Date(),
          updatedBy: session.user.id,
        },
      });

      return NextResponse.json({ success: true });
    }
    ```
  </action>
  <verify>
    `pnpm tsc --noEmit` - no TypeScript errors
    Test API endpoints with authenticated requests:
    - POST /api/employees creates employee with encrypted PII
    - GET /api/employees returns list with masked PII
    - GET /api/employees/[id] returns full (masked) details
  </verify>
  <done>
    Employee CRUD API complete with PII encryption, role-based access control, and validation.
  </done>
</task>

<task type="auto">
  <name>Task 3: Create Employee and Department management UI</name>
  <files>
    src/app/(dashboard)/employees/page.tsx
    src/app/(dashboard)/employees/new/page.tsx
    src/app/(dashboard)/employees/[id]/page.tsx
    src/app/(dashboard)/departments/page.tsx
    src/components/employees/employee-list.tsx
    src/components/employees/employee-form.tsx
    src/components/departments/department-form.tsx
  </files>
  <action>
    Install additional shadcn components:
    ```bash
    pnpm dlx shadcn@latest add table select dialog form textarea badge separator
    ```

    Create src/components/employees/employee-list.tsx:
    ```typescript
    'use client';

    import { useState, useEffect } from 'react';
    import Link from 'next/link';
    import { Button } from '@/components/ui/button';
    import { Input } from '@/components/ui/input';
    import { Badge } from '@/components/ui/badge';
    import {
      Table,
      TableBody,
      TableCell,
      TableHead,
      TableHeader,
      TableRow,
    } from '@/components/ui/table';
    import { Plus, Search, ChevronLeft, ChevronRight } from 'lucide-react';

    interface Employee {
      id: string;
      employeeCode: string;
      firstName: string;
      lastName: string;
      workEmail: string;
      status: string;
      department?: { id: string; name: string } | null;
      designation?: { id: string; title: string } | null;
    }

    export function EmployeeList() {
      const [employees, setEmployees] = useState<Employee[]>([]);
      const [search, setSearch] = useState('');
      const [page, setPage] = useState(1);
      const [totalPages, setTotalPages] = useState(1);
      const [isLoading, setIsLoading] = useState(true);

      useEffect(() => {
        fetchEmployees();
      }, [search, page]);

      async function fetchEmployees() {
        setIsLoading(true);
        const params = new URLSearchParams({
          page: page.toString(),
          limit: '20',
          ...(search && { search }),
        });

        const res = await fetch(`/api/employees?${params}`);
        const data = await res.json();

        setEmployees(data.employees || []);
        setTotalPages(data.pagination?.totalPages || 1);
        setIsLoading(false);
      }

      const statusColors: Record<string, string> = {
        ACTIVE: 'bg-green-100 text-green-800',
        INACTIVE: 'bg-gray-100 text-gray-800',
        TERMINATED: 'bg-red-100 text-red-800',
        ON_NOTICE: 'bg-yellow-100 text-yellow-800',
      };

      return (
        <div className="space-y-4">
          <div className="flex items-center justify-between">
            <div className="relative w-72">
              <Search className="absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-gray-400" />
              <Input
                placeholder="Search employees..."
                value={search}
                onChange={(e) => {
                  setSearch(e.target.value);
                  setPage(1);
                }}
                className="pl-10"
              />
            </div>
            <Button asChild>
              <Link href="/dashboard/employees/new">
                <Plus className="mr-2 h-4 w-4" />
                Add Employee
              </Link>
            </Button>
          </div>

          <div className="rounded-md border">
            <Table>
              <TableHeader>
                <TableRow>
                  <TableHead>Code</TableHead>
                  <TableHead>Name</TableHead>
                  <TableHead>Email</TableHead>
                  <TableHead>Department</TableHead>
                  <TableHead>Designation</TableHead>
                  <TableHead>Status</TableHead>
                </TableRow>
              </TableHeader>
              <TableBody>
                {isLoading ? (
                  <TableRow>
                    <TableCell colSpan={6} className="text-center py-8">
                      Loading...
                    </TableCell>
                  </TableRow>
                ) : employees.length === 0 ? (
                  <TableRow>
                    <TableCell colSpan={6} className="text-center py-8 text-gray-500">
                      No employees found
                    </TableCell>
                  </TableRow>
                ) : (
                  employees.map((emp) => (
                    <TableRow key={emp.id}>
                      <TableCell>
                        <Link
                          href={`/dashboard/employees/${emp.id}`}
                          className="font-medium text-blue-600 hover:underline"
                        >
                          {emp.employeeCode}
                        </Link>
                      </TableCell>
                      <TableCell>{emp.firstName} {emp.lastName}</TableCell>
                      <TableCell>{emp.workEmail}</TableCell>
                      <TableCell>{emp.department?.name || '-'}</TableCell>
                      <TableCell>{emp.designation?.title || '-'}</TableCell>
                      <TableCell>
                        <Badge className={statusColors[emp.status] || ''}>
                          {emp.status}
                        </Badge>
                      </TableCell>
                    </TableRow>
                  ))
                )}
              </TableBody>
            </Table>
          </div>

          {totalPages > 1 && (
            <div className="flex items-center justify-end gap-2">
              <Button
                variant="outline"
                size="sm"
                onClick={() => setPage((p) => Math.max(1, p - 1))}
                disabled={page === 1}
              >
                <ChevronLeft className="h-4 w-4" />
              </Button>
              <span className="text-sm text-gray-600">
                Page {page} of {totalPages}
              </span>
              <Button
                variant="outline"
                size="sm"
                onClick={() => setPage((p) => Math.min(totalPages, p + 1))}
                disabled={page === totalPages}
              >
                <ChevronRight className="h-4 w-4" />
              </Button>
            </div>
          )}
        </div>
      );
    }
    ```

    Create src/components/employees/employee-form.tsx:
    ```typescript
    'use client';

    import { useState, useEffect } from 'react';
    import { useRouter } from 'next/navigation';
    import { Button } from '@/components/ui/button';
    import { Input } from '@/components/ui/input';
    import { Label } from '@/components/ui/label';
    import { Textarea } from '@/components/ui/textarea';
    import {
      Select,
      SelectContent,
      SelectItem,
      SelectTrigger,
      SelectValue,
    } from '@/components/ui/select';
    import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
    import { Separator } from '@/components/ui/separator';

    interface Department { id: string; name: string; }
    interface Designation { id: string; title: string; }
    interface Manager { id: string; firstName: string; lastName: string; }

    interface EmployeeFormProps {
      employee?: any;
      isEdit?: boolean;
    }

    export function EmployeeForm({ employee, isEdit }: EmployeeFormProps) {
      const router = useRouter();
      const [isLoading, setIsLoading] = useState(false);
      const [error, setError] = useState('');

      const [departments, setDepartments] = useState<Department[]>([]);
      const [designations, setDesignations] = useState<Designation[]>([]);
      const [managers, setManagers] = useState<Manager[]>([]);

      const [formData, setFormData] = useState({
        employeeCode: employee?.employeeCode || '',
        firstName: employee?.firstName || '',
        lastName: employee?.lastName || '',
        dateOfBirth: employee?.dateOfBirth?.split('T')[0] || '',
        gender: employee?.gender || 'MALE',
        personalEmail: employee?.personalEmail || '',
        workEmail: employee?.workEmail || '',
        phone: employee?.phone || '',
        emergencyContact: employee?.emergencyContact || '',
        emergencyPhone: employee?.emergencyPhone || '',
        currentAddress: employee?.currentAddress || '',
        permanentAddress: employee?.permanentAddress || '',
        city: employee?.city || '',
        state: employee?.state || '',
        pincode: employee?.pincode || '',
        dateOfJoining: employee?.dateOfJoining?.split('T')[0] || '',
        status: employee?.status || 'ACTIVE',
        noticePeriodDays: employee?.noticePeriodDays || 30,
        departmentId: employee?.departmentId || '',
        designationId: employee?.designationId || '',
        reportingManagerId: employee?.reportingManagerId || '',
        panNumber: employee?._sensitive?.panNumber || '',
        aadhaarNumber: employee?._sensitive?.aadhaarNumber || '',
        bankAccountNumber: employee?._sensitive?.bankAccountNumber || '',
        bankIfscCode: employee?.bankIfscCode || '',
        bankName: employee?.bankName || '',
        uanNumber: employee?.uanNumber || '',
        pfNumber: employee?.pfNumber || '',
        esiNumber: employee?.esiNumber || '',
      });

      useEffect(() => {
        async function fetchOptions() {
          const [deptRes, desigRes, empRes] = await Promise.all([
            fetch('/api/departments'),
            fetch('/api/designations'),
            fetch('/api/employees?limit=100'),
          ]);

          const depts = await deptRes.json();
          const desigs = await desigRes.json();
          const emps = await empRes.json();

          setDepartments(depts);
          setDesignations(desigs);
          setManagers(emps.employees?.filter((e: any) => e.id !== employee?.id) || []);
        }
        fetchOptions();
      }, [employee?.id]);

      function handleChange(field: string, value: string | number) {
        setFormData((prev) => ({ ...prev, [field]: value }));
      }

      async function handleSubmit(e: React.FormEvent) {
        e.preventDefault();
        setError('');
        setIsLoading(true);

        try {
          const url = isEdit ? `/api/employees/${employee.id}` : '/api/employees';
          const method = isEdit ? 'PUT' : 'POST';

          const res = await fetch(url, {
            method,
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              ...formData,
              noticePeriodDays: parseInt(formData.noticePeriodDays.toString()),
              departmentId: formData.departmentId || null,
              designationId: formData.designationId || null,
              reportingManagerId: formData.reportingManagerId || null,
            }),
          });

          if (!res.ok) {
            const data = await res.json();
            throw new Error(data.error || 'Failed to save employee');
          }

          router.push('/dashboard/employees');
          router.refresh();
        } catch (err) {
          setError(err instanceof Error ? err.message : 'An error occurred');
        } finally {
          setIsLoading(false);
        }
      }

      return (
        <form onSubmit={handleSubmit} className="space-y-6">
          {error && (
            <div className="p-3 text-sm text-red-600 bg-red-50 rounded-md">{error}</div>
          )}

          <Card>
            <CardHeader>
              <CardTitle>Personal Information</CardTitle>
            </CardHeader>
            <CardContent className="grid gap-4 md:grid-cols-2">
              <div className="space-y-2">
                <Label htmlFor="employeeCode">Employee Code *</Label>
                <Input
                  id="employeeCode"
                  value={formData.employeeCode}
                  onChange={(e) => handleChange('employeeCode', e.target.value)}
                  required
                  disabled={isEdit}
                  placeholder="EMP001"
                />
              </div>
              <div className="space-y-2">
                <Label htmlFor="workEmail">Work Email *</Label>
                <Input
                  id="workEmail"
                  type="email"
                  value={formData.workEmail}
                  onChange={(e) => handleChange('workEmail', e.target.value)}
                  required
                />
              </div>
              <div className="space-y-2">
                <Label htmlFor="firstName">First Name *</Label>
                <Input
                  id="firstName"
                  value={formData.firstName}
                  onChange={(e) => handleChange('firstName', e.target.value)}
                  required
                />
              </div>
              <div className="space-y-2">
                <Label htmlFor="lastName">Last Name *</Label>
                <Input
                  id="lastName"
                  value={formData.lastName}
                  onChange={(e) => handleChange('lastName', e.target.value)}
                  required
                />
              </div>
              <div className="space-y-2">
                <Label htmlFor="dateOfBirth">Date of Birth *</Label>
                <Input
                  id="dateOfBirth"
                  type="date"
                  value={formData.dateOfBirth}
                  onChange={(e) => handleChange('dateOfBirth', e.target.value)}
                  required
                />
              </div>
              <div className="space-y-2">
                <Label htmlFor="gender">Gender *</Label>
                <Select value={formData.gender} onValueChange={(v) => handleChange('gender', v)}>
                  <SelectTrigger>
                    <SelectValue />
                  </SelectTrigger>
                  <SelectContent>
                    <SelectItem value="MALE">Male</SelectItem>
                    <SelectItem value="FEMALE">Female</SelectItem>
                    <SelectItem value="OTHER">Other</SelectItem>
                  </SelectContent>
                </Select>
              </div>
              <div className="space-y-2">
                <Label htmlFor="phone">Phone *</Label>
                <Input
                  id="phone"
                  value={formData.phone}
                  onChange={(e) => handleChange('phone', e.target.value)}
                  required
                />
              </div>
              <div className="space-y-2">
                <Label htmlFor="personalEmail">Personal Email</Label>
                <Input
                  id="personalEmail"
                  type="email"
                  value={formData.personalEmail}
                  onChange={(e) => handleChange('personalEmail', e.target.value)}
                />
              </div>
            </CardContent>
          </Card>

          <Card>
            <CardHeader>
              <CardTitle>Employment Details</CardTitle>
            </CardHeader>
            <CardContent className="grid gap-4 md:grid-cols-2">
              <div className="space-y-2">
                <Label htmlFor="dateOfJoining">Date of Joining *</Label>
                <Input
                  id="dateOfJoining"
                  type="date"
                  value={formData.dateOfJoining}
                  onChange={(e) => handleChange('dateOfJoining', e.target.value)}
                  required
                />
              </div>
              <div className="space-y-2">
                <Label htmlFor="status">Status</Label>
                <Select value={formData.status} onValueChange={(v) => handleChange('status', v)}>
                  <SelectTrigger>
                    <SelectValue />
                  </SelectTrigger>
                  <SelectContent>
                    <SelectItem value="ACTIVE">Active</SelectItem>
                    <SelectItem value="INACTIVE">Inactive</SelectItem>
                    <SelectItem value="ON_NOTICE">On Notice</SelectItem>
                    <SelectItem value="TERMINATED">Terminated</SelectItem>
                  </SelectContent>
                </Select>
              </div>
              <div className="space-y-2">
                <Label htmlFor="departmentId">Department</Label>
                <Select value={formData.departmentId} onValueChange={(v) => handleChange('departmentId', v)}>
                  <SelectTrigger>
                    <SelectValue placeholder="Select department" />
                  </SelectTrigger>
                  <SelectContent>
                    {departments.map((d) => (
                      <SelectItem key={d.id} value={d.id}>{d.name}</SelectItem>
                    ))}
                  </SelectContent>
                </Select>
              </div>
              <div className="space-y-2">
                <Label htmlFor="designationId">Designation</Label>
                <Select value={formData.designationId} onValueChange={(v) => handleChange('designationId', v)}>
                  <SelectTrigger>
                    <SelectValue placeholder="Select designation" />
                  </SelectTrigger>
                  <SelectContent>
                    {designations.map((d) => (
                      <SelectItem key={d.id} value={d.id}>{d.title}</SelectItem>
                    ))}
                  </SelectContent>
                </Select>
              </div>
              <div className="space-y-2">
                <Label htmlFor="reportingManagerId">Reporting Manager</Label>
                <Select value={formData.reportingManagerId} onValueChange={(v) => handleChange('reportingManagerId', v)}>
                  <SelectTrigger>
                    <SelectValue placeholder="Select manager" />
                  </SelectTrigger>
                  <SelectContent>
                    {managers.map((m) => (
                      <SelectItem key={m.id} value={m.id}>{m.firstName} {m.lastName}</SelectItem>
                    ))}
                  </SelectContent>
                </Select>
              </div>
              <div className="space-y-2">
                <Label htmlFor="noticePeriodDays">Notice Period (days)</Label>
                <Input
                  id="noticePeriodDays"
                  type="number"
                  min="0"
                  max="180"
                  value={formData.noticePeriodDays}
                  onChange={(e) => handleChange('noticePeriodDays', e.target.value)}
                />
              </div>
            </CardContent>
          </Card>

          <Card>
            <CardHeader>
              <CardTitle>Sensitive Information (Encrypted)</CardTitle>
            </CardHeader>
            <CardContent className="grid gap-4 md:grid-cols-2">
              <div className="space-y-2">
                <Label htmlFor="panNumber">PAN Number</Label>
                <Input
                  id="panNumber"
                  value={formData.panNumber}
                  onChange={(e) => handleChange('panNumber', e.target.value.toUpperCase())}
                  placeholder="ABCDE1234F"
                  maxLength={10}
                />
              </div>
              <div className="space-y-2">
                <Label htmlFor="aadhaarNumber">Aadhaar Number</Label>
                <Input
                  id="aadhaarNumber"
                  value={formData.aadhaarNumber}
                  onChange={(e) => handleChange('aadhaarNumber', e.target.value.replace(/\D/g, ''))}
                  placeholder="123456789012"
                  maxLength={12}
                />
              </div>
              <div className="space-y-2">
                <Label htmlFor="bankAccountNumber">Bank Account Number</Label>
                <Input
                  id="bankAccountNumber"
                  value={formData.bankAccountNumber}
                  onChange={(e) => handleChange('bankAccountNumber', e.target.value)}
                />
              </div>
              <div className="space-y-2">
                <Label htmlFor="bankIfscCode">IFSC Code</Label>
                <Input
                  id="bankIfscCode"
                  value={formData.bankIfscCode}
                  onChange={(e) => handleChange('bankIfscCode', e.target.value.toUpperCase())}
                  placeholder="SBIN0001234"
                />
              </div>
              <div className="space-y-2">
                <Label htmlFor="bankName">Bank Name</Label>
                <Input
                  id="bankName"
                  value={formData.bankName}
                  onChange={(e) => handleChange('bankName', e.target.value)}
                />
              </div>
            </CardContent>
          </Card>

          <Card>
            <CardHeader>
              <CardTitle>Statutory Information</CardTitle>
            </CardHeader>
            <CardContent className="grid gap-4 md:grid-cols-3">
              <div className="space-y-2">
                <Label htmlFor="uanNumber">UAN Number</Label>
                <Input
                  id="uanNumber"
                  value={formData.uanNumber}
                  onChange={(e) => handleChange('uanNumber', e.target.value)}
                />
              </div>
              <div className="space-y-2">
                <Label htmlFor="pfNumber">PF Number</Label>
                <Input
                  id="pfNumber"
                  value={formData.pfNumber}
                  onChange={(e) => handleChange('pfNumber', e.target.value)}
                />
              </div>
              <div className="space-y-2">
                <Label htmlFor="esiNumber">ESI Number</Label>
                <Input
                  id="esiNumber"
                  value={formData.esiNumber}
                  onChange={(e) => handleChange('esiNumber', e.target.value)}
                />
              </div>
            </CardContent>
          </Card>

          <Card>
            <CardHeader>
              <CardTitle>Address</CardTitle>
            </CardHeader>
            <CardContent className="grid gap-4">
              <div className="space-y-2">
                <Label htmlFor="currentAddress">Current Address</Label>
                <Textarea
                  id="currentAddress"
                  value={formData.currentAddress}
                  onChange={(e) => handleChange('currentAddress', e.target.value)}
                />
              </div>
              <div className="grid gap-4 md:grid-cols-3">
                <div className="space-y-2">
                  <Label htmlFor="city">City</Label>
                  <Input
                    id="city"
                    value={formData.city}
                    onChange={(e) => handleChange('city', e.target.value)}
                  />
                </div>
                <div className="space-y-2">
                  <Label htmlFor="state">State</Label>
                  <Input
                    id="state"
                    value={formData.state}
                    onChange={(e) => handleChange('state', e.target.value)}
                  />
                </div>
                <div className="space-y-2">
                  <Label htmlFor="pincode">Pincode</Label>
                  <Input
                    id="pincode"
                    value={formData.pincode}
                    onChange={(e) => handleChange('pincode', e.target.value)}
                  />
                </div>
              </div>
            </CardContent>
          </Card>

          <div className="flex gap-4">
            <Button type="submit" disabled={isLoading}>
              {isLoading ? 'Saving...' : isEdit ? 'Update Employee' : 'Create Employee'}
            </Button>
            <Button type="button" variant="outline" onClick={() => router.back()}>
              Cancel
            </Button>
          </div>
        </form>
      );
    }
    ```

    Create src/app/(dashboard)/employees/page.tsx:
    ```typescript
    import { EmployeeList } from '@/components/employees/employee-list';

    export default function EmployeesPage() {
      return (
        <div className="space-y-6">
          <div>
            <h1 className="text-2xl font-bold text-gray-900">Employees</h1>
            <p className="text-gray-600">Manage employee records</p>
          </div>
          <EmployeeList />
        </div>
      );
    }
    ```

    Create src/app/(dashboard)/employees/new/page.tsx:
    ```typescript
    import { EmployeeForm } from '@/components/employees/employee-form';

    export default function NewEmployeePage() {
      return (
        <div className="space-y-6">
          <div>
            <h1 className="text-2xl font-bold text-gray-900">Add New Employee</h1>
            <p className="text-gray-600">Create a new employee record</p>
          </div>
          <EmployeeForm />
        </div>
      );
    }
    ```

    Create src/app/(dashboard)/employees/[id]/page.tsx:
    ```typescript
    import { notFound } from 'next/navigation';
    import { EmployeeForm } from '@/components/employees/employee-form';
    import { prisma } from '@/lib/db';

    export default async function EditEmployeePage({
      params,
    }: {
      params: Promise<{ id: string }>;
    }) {
      const { id } = await params;

      const employee = await prisma.employee.findUnique({
        where: { id },
        include: {
          department: true,
          designation: true,
          reportingManager: true,
        },
      });

      if (!employee) {
        notFound();
      }

      // Convert dates to strings for the form
      const formattedEmployee = {
        ...employee,
        dateOfBirth: employee.dateOfBirth.toISOString(),
        dateOfJoining: employee.dateOfJoining.toISOString(),
        // Note: _sensitive data fetched via API for security
      };

      return (
        <div className="space-y-6">
          <div>
            <h1 className="text-2xl font-bold text-gray-900">Edit Employee</h1>
            <p className="text-gray-600">{employee.firstName} {employee.lastName}</p>
          </div>
          <EmployeeForm employee={formattedEmployee} isEdit />
        </div>
      );
    }
    ```

    Create src/app/(dashboard)/departments/page.tsx:
    ```typescript
    'use client';

    import { useState, useEffect } from 'react';
    import { Button } from '@/components/ui/button';
    import { Input } from '@/components/ui/input';
    import { Label } from '@/components/ui/label';
    import { Badge } from '@/components/ui/badge';
    import {
      Table,
      TableBody,
      TableCell,
      TableHead,
      TableHeader,
      TableRow,
    } from '@/components/ui/table';
    import {
      Dialog,
      DialogContent,
      DialogHeader,
      DialogTitle,
      DialogTrigger,
    } from '@/components/ui/dialog';
    import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
    import { Textarea } from '@/components/ui/textarea';
    import { Plus, Pencil, Trash2 } from 'lucide-react';

    interface Department {
      id: string;
      name: string;
      code: string;
      description: string | null;
      isActive: boolean;
      _count: { employees: number };
    }

    interface Designation {
      id: string;
      title: string;
      level: number;
      description: string | null;
      isActive: boolean;
      _count: { employees: number };
    }

    export default function DepartmentsPage() {
      const [departments, setDepartments] = useState<Department[]>([]);
      const [designations, setDesignations] = useState<Designation[]>([]);
      const [isLoading, setIsLoading] = useState(true);
      const [deptDialogOpen, setDeptDialogOpen] = useState(false);
      const [desigDialogOpen, setDesigDialogOpen] = useState(false);

      const [deptForm, setDeptForm] = useState({ name: '', code: '', description: '' });
      const [desigForm, setDesigForm] = useState({ title: '', level: 1, description: '' });

      useEffect(() => {
        fetchData();
      }, []);

      async function fetchData() {
        setIsLoading(true);
        const [deptRes, desigRes] = await Promise.all([
          fetch('/api/departments'),
          fetch('/api/designations'),
        ]);
        setDepartments(await deptRes.json());
        setDesignations(await desigRes.json());
        setIsLoading(false);
      }

      async function createDepartment(e: React.FormEvent) {
        e.preventDefault();
        await fetch('/api/departments', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(deptForm),
        });
        setDeptForm({ name: '', code: '', description: '' });
        setDeptDialogOpen(false);
        fetchData();
      }

      async function createDesignation(e: React.FormEvent) {
        e.preventDefault();
        await fetch('/api/designations', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(desigForm),
        });
        setDesigForm({ title: '', level: 1, description: '' });
        setDesigDialogOpen(false);
        fetchData();
      }

      async function deleteDepartment(id: string) {
        if (!confirm('Delete this department?')) return;
        await fetch(`/api/departments/${id}`, { method: 'DELETE' });
        fetchData();
      }

      async function deleteDesignation(id: string) {
        if (!confirm('Delete this designation?')) return;
        await fetch(`/api/designations/${id}`, { method: 'DELETE' });
        fetchData();
      }

      return (
        <div className="space-y-8">
          <div>
            <h1 className="text-2xl font-bold text-gray-900">Organization Structure</h1>
            <p className="text-gray-600">Manage departments and designations</p>
          </div>

          <div className="grid gap-8 lg:grid-cols-2">
            <Card>
              <CardHeader className="flex flex-row items-center justify-between">
                <CardTitle>Departments</CardTitle>
                <Dialog open={deptDialogOpen} onOpenChange={setDeptDialogOpen}>
                  <DialogTrigger asChild>
                    <Button size="sm">
                      <Plus className="mr-2 h-4 w-4" />
                      Add
                    </Button>
                  </DialogTrigger>
                  <DialogContent>
                    <DialogHeader>
                      <DialogTitle>Add Department</DialogTitle>
                    </DialogHeader>
                    <form onSubmit={createDepartment} className="space-y-4">
                      <div className="space-y-2">
                        <Label htmlFor="deptName">Name</Label>
                        <Input
                          id="deptName"
                          value={deptForm.name}
                          onChange={(e) => setDeptForm({ ...deptForm, name: e.target.value })}
                          required
                        />
                      </div>
                      <div className="space-y-2">
                        <Label htmlFor="deptCode">Code</Label>
                        <Input
                          id="deptCode"
                          value={deptForm.code}
                          onChange={(e) => setDeptForm({ ...deptForm, code: e.target.value.toUpperCase() })}
                          required
                          maxLength={10}
                        />
                      </div>
                      <div className="space-y-2">
                        <Label htmlFor="deptDesc">Description</Label>
                        <Textarea
                          id="deptDesc"
                          value={deptForm.description}
                          onChange={(e) => setDeptForm({ ...deptForm, description: e.target.value })}
                        />
                      </div>
                      <Button type="submit" className="w-full">Create Department</Button>
                    </form>
                  </DialogContent>
                </Dialog>
              </CardHeader>
              <CardContent>
                <Table>
                  <TableHeader>
                    <TableRow>
                      <TableHead>Name</TableHead>
                      <TableHead>Code</TableHead>
                      <TableHead>Employees</TableHead>
                      <TableHead></TableHead>
                    </TableRow>
                  </TableHeader>
                  <TableBody>
                    {departments.map((dept) => (
                      <TableRow key={dept.id}>
                        <TableCell className="font-medium">{dept.name}</TableCell>
                        <TableCell><Badge variant="outline">{dept.code}</Badge></TableCell>
                        <TableCell>{dept._count.employees}</TableCell>
                        <TableCell>
                          <Button
                            variant="ghost"
                            size="sm"
                            onClick={() => deleteDepartment(dept.id)}
                            disabled={dept._count.employees > 0}
                          >
                            <Trash2 className="h-4 w-4" />
                          </Button>
                        </TableCell>
                      </TableRow>
                    ))}
                  </TableBody>
                </Table>
              </CardContent>
            </Card>

            <Card>
              <CardHeader className="flex flex-row items-center justify-between">
                <CardTitle>Designations</CardTitle>
                <Dialog open={desigDialogOpen} onOpenChange={setDesigDialogOpen}>
                  <DialogTrigger asChild>
                    <Button size="sm">
                      <Plus className="mr-2 h-4 w-4" />
                      Add
                    </Button>
                  </DialogTrigger>
                  <DialogContent>
                    <DialogHeader>
                      <DialogTitle>Add Designation</DialogTitle>
                    </DialogHeader>
                    <form onSubmit={createDesignation} className="space-y-4">
                      <div className="space-y-2">
                        <Label htmlFor="desigTitle">Title</Label>
                        <Input
                          id="desigTitle"
                          value={desigForm.title}
                          onChange={(e) => setDesigForm({ ...desigForm, title: e.target.value })}
                          required
                        />
                      </div>
                      <div className="space-y-2">
                        <Label htmlFor="desigLevel">Level (1-10)</Label>
                        <Input
                          id="desigLevel"
                          type="number"
                          min="1"
                          max="10"
                          value={desigForm.level}
                          onChange={(e) => setDesigForm({ ...desigForm, level: parseInt(e.target.value) })}
                          required
                        />
                      </div>
                      <div className="space-y-2">
                        <Label htmlFor="desigDesc">Description</Label>
                        <Textarea
                          id="desigDesc"
                          value={desigForm.description}
                          onChange={(e) => setDesigForm({ ...desigForm, description: e.target.value })}
                        />
                      </div>
                      <Button type="submit" className="w-full">Create Designation</Button>
                    </form>
                  </DialogContent>
                </Dialog>
              </CardHeader>
              <CardContent>
                <Table>
                  <TableHeader>
                    <TableRow>
                      <TableHead>Title</TableHead>
                      <TableHead>Level</TableHead>
                      <TableHead>Employees</TableHead>
                      <TableHead></TableHead>
                    </TableRow>
                  </TableHeader>
                  <TableBody>
                    {designations.map((desig) => (
                      <TableRow key={desig.id}>
                        <TableCell className="font-medium">{desig.title}</TableCell>
                        <TableCell>{desig.level}</TableCell>
                        <TableCell>{desig._count.employees}</TableCell>
                        <TableCell>
                          <Button
                            variant="ghost"
                            size="sm"
                            onClick={() => deleteDesignation(desig.id)}
                            disabled={desig._count.employees > 0}
                          >
                            <Trash2 className="h-4 w-4" />
                          </Button>
                        </TableCell>
                      </TableRow>
                    ))}
                  </TableBody>
                </Table>
              </CardContent>
            </Card>
          </div>
        </div>
      );
    }
    ```
  </action>
  <verify>
    1. `pnpm dev` and visit /dashboard/employees
    2. Click "Add Employee" - form renders with all sections
    3. Create a department first, then a designation
    4. Create an employee with department and designation
    5. Employee appears in list with correct info
    6. Click employee code to view/edit
    7. PII fields show as masked in list view
  </verify>
  <done>
    Complete employee management UI with list, create, edit pages.
    Department and designation management page with CRUD.
    All forms validate and submit correctly.
  </done>
</task>

</tasks>

<verification>
1. POST /api/departments creates department
2. POST /api/designations creates designation
3. POST /api/employees creates employee with encrypted PII
4. GET /api/employees returns paginated list with masked PII
5. PUT /api/employees/:id updates employee
6. UI: Employee list with search and pagination
7. UI: Employee form with all required fields
8. UI: Departments page with CRUD
9. PII encrypted in database, masked in API responses
</verification>

<success_criteria>
- Department CRUD API and UI working
- Designation CRUD API and UI working
- Employee CRUD API with PII encryption (PAN, Aadhaar, bank)
- Employee list with search, pagination, filters
- Employee form with personal info, employment, address, sensitive, statutory sections
- Role-based access: Admin can CRUD, Manager can view team, Employee can view self
- Validation with Zod schemas
- Audit fields populated on create/update
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-03-SUMMARY.md`
</output>
