# 08-02 Debug: Dashboard Approvals, Expense Management & Caching

## Investigation Summary

### 1. Dashboard Approvals Issue (`/dashboard/approvals`)

**Page:** `src/app/dashboard/approvals/page.tsx`

**Issue Found:** The page has a tab linking to `/dashboard/leave/approvals` (line 83) which **does not exist**.

```tsx
<a href="/dashboard/leave/approvals" ...>
  Leave Requests
```

**Root Cause:** The leave approvals functionality is already built into `/dashboard/leave/page.tsx` via the `<LeaveRequestsList showApproval />` component for managers. There's no separate `/dashboard/leave/approvals` page.

**Fix:** Change the link from `/dashboard/leave/approvals` to `/dashboard/leave`

---

### 2. Expense Management Issue

**Page:** `src/app/dashboard/expenses/page.tsx`
**Component:** `src/components/expenses/expense-list.tsx`

**Issue Found:** The ExpenseList component has incorrect links on lines 61 and 93:

```tsx
<Link href={`/expenses/${expense.id}`}>  // WRONG
```

Should be:

```tsx
<Link href={`/dashboard/expenses/${expense.id}`}>  // CORRECT
```

**Root Cause:** The expense detail page is at `/dashboard/expenses/[id]/page.tsx`, but the links point to a non-existent `/expenses/[id]` route.

**Additional Note:** The same component is used on `/employee/expenses/page.tsx` - need to verify this works for both contexts. Actually, both admin and employee should route to `/dashboard/expenses/[id]` since that's where the detail page is.

---

### 3. Caching Verification

**File:** `src/lib/cache.ts`

**Status:** ✅ Implementation is correct for Next.js 16.x

**Findings:**
- Uses `unstable_cache` correctly with proper key arrays and options
- Tags are properly defined for cache invalidation
- `revalidateTag(tag, { expire: 0 })` matches Next.js 16 API signature:
  ```ts
  revalidateTag(tag: string, profile: string | CacheLifeConfig): undefined
  ```

**Cached Data:**
| Function | Cache Key | TTL | Tags |
|----------|-----------|-----|------|
| `getCachedDepartments` | `departments-active` | 1 hour | `departments` |
| `getCachedDesignations` | `designations-active` | 1 hour | `designations` |
| `getCachedLeaveTypes` | `leave-types-active` | 15 min | `leave-types` |
| `getCachedAllLeaveTypes` | `leave-types-all` | 15 min | `leave-types` |
| `getCachedDepartmentsWithCounts` | `departments-with-counts` | 15 min | `departments` |
| `getCachedDesignationsWithCounts` | `designations-with-counts` | 15 min | `designations` |
| `getCachedDashboardCounts` | `dashboard-counts` | 5 min | `dashboard` |

**Cache Verification Plan:** Add logging to verify cache hits/misses using a wrapper function.

---

## Execution Plan

1. ✅ Fix `/dashboard/leave/approvals` link → `/dashboard/leave`
2. ✅ Fix expense list links → `/dashboard/expenses/${id}`
3. ✅ Add cache logging wrapper for verification
4. ✅ Test both fixes work correctly
5. ✅ Commit and push
