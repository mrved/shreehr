---
phase: 04-employee-self-service
plan: 04
type: execute
wave: 1
depends_on: []
files_modified:
  - src/app/(employee)/layout.tsx
  - src/app/(employee)/dashboard/page.tsx
  - src/app/(employee)/payslips/page.tsx
  - src/app/(employee)/payslips/[id]/page.tsx
  - src/components/employee/dashboard-stats.tsx
  - src/components/employee/payslip-list.tsx
  - src/components/employee/pdf-viewer.tsx
autonomous: true

must_haves:
  truths:
    - "Employee can access mobile-optimized dashboard"
    - "Employee can view list of past payslips by month"
    - "Employee can view payslip PDF on mobile with zoom support"
    - "Employee can download payslip as PDF file"
  artifacts:
    - path: "src/app/(employee)/layout.tsx"
      provides: "Employee portal layout with mobile navigation"
      min_lines: 40
    - path: "src/app/(employee)/dashboard/page.tsx"
      provides: "Employee dashboard with quick stats"
      min_lines: 50
    - path: "src/app/(employee)/payslips/page.tsx"
      provides: "Payslip list page"
      min_lines: 40
    - path: "src/app/(employee)/payslips/[id]/page.tsx"
      provides: "Payslip viewer page"
      min_lines: 40
    - path: "src/components/employee/pdf-viewer.tsx"
      provides: "Mobile-optimized PDF viewer component"
      min_lines: 30
  key_links:
    - from: "src/app/(employee)/payslips/[id]/page.tsx"
      to: "/api/payroll/[runId]/payslips/[employeeId]"
      via: "Fetch payslip PDF"
      pattern: "api/payroll.*payslips"
    - from: "src/app/(employee)/layout.tsx"
      to: "auth()"
      via: "Session check for employee access"
      pattern: "import.*auth"
---

<objective>
Create mobile-first employee portal with dashboard and payslip viewing functionality.

Purpose: Enable employees to access their payslips and key information from mobile devices.
Output: Employee portal layout, dashboard, and payslip viewing pages with mobile-optimized UI.
</objective>

<execution_context>
@C:\Users\ved\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\ved\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-employee-self-service/04-RESEARCH.md

# Existing patterns
@src/app/(dashboard)/layout.tsx
@src/app/(dashboard)/payroll/page.tsx
@src/app/api/payroll/[runId]/payslips/[employeeId]/route.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create employee portal layout with mobile navigation</name>
  <files>src/app/(employee)/layout.tsx, src/components/employee/dashboard-stats.tsx</files>
  <action>
1. Create `src/app/(employee)/layout.tsx`:
   - Import auth from @/lib/auth
   - Redirect to /login if not authenticated
   - Redirect to /dashboard if user is ADMIN/HR_MANAGER (they use admin portal)
   - Mobile-first responsive layout:
     - Fixed bottom navigation on mobile (Home, Payslips, Leave, Profile icons)
     - Sidebar navigation on desktop (md: breakpoint)
   - Navigation items: Dashboard, Payslips, Attendance, Leave, Investments, Profile
   - Header with employee name and avatar
   - Use Tailwind mobile-first: unprefixed = mobile, md: = desktop

2. Create `src/components/employee/dashboard-stats.tsx`:
   - Accept props: { leaveBalance, currentMonthPayslip, pendingRequests }
   - Mobile-first card layout (1 col mobile, 2 cols tablet, 4 cols desktop)
   - Stats cards:
     - Leave Balance (available days)
     - Last Payslip (month, net salary)
     - Pending Requests (leave/profile updates count)
     - Quick Actions (Apply Leave, View Payslip buttons)
   - Touch-friendly: min 44x44px tap targets
   - Use icons from lucide-react

Layout structure:
```tsx
<div className="min-h-screen pb-16 md:pb-0 md:pl-64">
  {/* Desktop sidebar */}
  <aside className="hidden md:fixed md:inset-y-0 md:flex md:w-64 md:flex-col">
    {/* Nav items */}
  </aside>

  {/* Mobile bottom nav */}
  <nav className="fixed bottom-0 left-0 right-0 z-50 md:hidden bg-white border-t">
    {/* Bottom tabs */}
  </nav>

  {/* Main content */}
  <main className="p-4 md:p-8">
    {children}
  </main>
</div>
```
  </action>
  <verify>`pnpm tsc --noEmit` passes</verify>
  <done>Employee portal layout with mobile navigation ready</done>
</task>

<task type="auto">
  <name>Task 2: Create dashboard and payslip pages</name>
  <files>src/app/(employee)/dashboard/page.tsx, src/app/(employee)/payslips/page.tsx, src/app/(employee)/payslips/[id]/page.tsx, src/components/employee/payslip-list.tsx, src/components/employee/pdf-viewer.tsx</files>
  <action>
1. Install react-pdf-viewer: `pnpm add @react-pdf-viewer/core @react-pdf-viewer/default-layout pdfjs-dist`

2. Create `src/app/(employee)/dashboard/page.tsx`:
   - Server component fetching employee stats
   - Use auth() to get employeeId
   - Fetch: current month payslip, leave balances, pending requests count
   - Render DashboardStats component
   - Quick links to Payslips, Apply Leave, Profile

3. Create `src/components/employee/payslip-list.tsx`:
   - Client component with payslip cards
   - Props: payslips array with { id, month, year, netSalary, pdfUrl }
   - Mobile cards showing month/year and net salary
   - Desktop: table layout with more columns
   - Link to /payslips/[runId] for viewing

4. Create `src/app/(employee)/payslips/page.tsx`:
   - Server component fetching employee's payroll records
   - Query payroll_records where employee_id = session.user.employeeId
   - Order by year desc, month desc
   - Render PayslipList component

5. Create `src/components/employee/pdf-viewer.tsx`:
   - Client component using @react-pdf-viewer/core
   - Props: { pdfUrl, fileName }
   - Mobile-optimized: full width, touch zoom enabled
   - Download button fixed at bottom on mobile
   - Fallback link if PDF fails to load

6. Create `src/app/(employee)/payslips/[id]/page.tsx`:
   - Server component, [id] is payroll_run_id
   - Verify employee has access to this payslip (RBAC)
   - Fetch payroll record details
   - Pass PDF URL to PDFViewer component
   - Download button with proper filename

PDF URL pattern: `/api/payroll/${runId}/payslips/${employeeId}`

Mobile-first patterns:
- Cards on mobile, table on desktop
- Full-width on mobile, constrained on desktop
- Touch-friendly buttons (min 44px)
  </action>
  <verify>
1. `pnpm tsc --noEmit` passes
2. Visit /payslips in browser shows list
3. Visit /payslips/[id] shows PDF viewer
  </verify>
  <done>Dashboard shows stats, payslips viewable on mobile</done>
</task>

</tasks>

<verification>
1. `pnpm tsc --noEmit` passes
2. Employee layout redirects non-employees appropriately
3. Bottom navigation visible on mobile, sidebar on desktop
4. Payslip list shows correct data
5. PDF viewer works with zoom on mobile
</verification>

<success_criteria>
- Employee portal accessible at /dashboard (employee route)
- Mobile bottom navigation with 4-5 tabs
- Desktop sidebar navigation
- Dashboard shows leave balance, last payslip, pending counts
- Payslip list shows history
- PDF viewer works with pinch-to-zoom
- Download button functional
</success_criteria>

<output>
After completion, create `.planning/phases/04-employee-self-service/04-04-SUMMARY.md`
</output>
