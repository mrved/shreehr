---
phase: 04-employee-self-service
plan: 05
type: execute
wave: 1
depends_on: []
files_modified:
  - src/app/(employee)/attendance/page.tsx
  - src/app/(employee)/leave/page.tsx
  - src/app/(employee)/leave/apply/page.tsx
  - src/components/employee/attendance-calendar.tsx
  - src/components/employee/leave-balance-cards.tsx
  - src/components/employee/leave-request-form.tsx
autonomous: true

must_haves:
  truths:
    - "Employee can view attendance records with daily punch details"
    - "Employee can view monthly attendance summary"
    - "Employee can view leave balances by type"
    - "Employee can apply for leave with real-time balance validation"
  artifacts:
    - path: "src/app/(employee)/attendance/page.tsx"
      provides: "Attendance viewing page"
      min_lines: 40
    - path: "src/app/(employee)/leave/page.tsx"
      provides: "Leave dashboard page"
      min_lines: 40
    - path: "src/app/(employee)/leave/apply/page.tsx"
      provides: "Leave application page"
      min_lines: 30
    - path: "src/components/employee/attendance-calendar.tsx"
      provides: "Mobile attendance calendar component"
      min_lines: 50
    - path: "src/components/employee/leave-request-form.tsx"
      provides: "Leave application form with validation"
      min_lines: 80
  key_links:
    - from: "src/app/(employee)/attendance/page.tsx"
      to: "/api/attendance"
      via: "Fetch attendance data"
      pattern: "api/attendance"
    - from: "src/components/employee/leave-request-form.tsx"
      to: "/api/leave-requests"
      via: "Submit leave request"
      pattern: "api/leave-requests"
---

<objective>
Create mobile-first attendance viewing and leave application pages for employee portal.

Purpose: Enable employees to track their attendance and apply for leave with balance validation.
Output: Attendance calendar, leave balance cards, and leave application form.
</objective>

<execution_context>
@C:\Users\ved\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\ved\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-employee-self-service/04-RESEARCH.md

# Existing APIs and components
@src/app/api/attendance/route.ts
@src/app/api/leave-requests/route.ts
@src/app/api/leave-balances/route.ts
@src/components/attendance/attendance-calendar.tsx
@src/components/leave/leave-request-form.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create attendance viewing page</name>
  <files>src/app/(employee)/attendance/page.tsx, src/components/employee/attendance-calendar.tsx</files>
  <action>
1. Create `src/components/employee/attendance-calendar.tsx`:
   - Client component
   - Props: { attendances: Attendance[], month: number, year: number }
   - Mobile-first calendar grid layout:
     - 7 columns (Sun-Sat), responsive cell sizes
     - Color-coded days: green (present), red (absent), yellow (half-day), blue (on leave)
     - Touch tap to view day details in bottom sheet/modal
   - Monthly summary at top: Present count, Absent count, Leave count, Half-day count
   - Navigation arrows for month switching
   - Today highlighted with ring/border

2. Create `src/app/(employee)/attendance/page.tsx`:
   - Server component
   - Get current month/year from searchParams or default to current
   - Fetch attendance records for employee from API
   - Fetch monthly summary (aggregate counts)
   - Pass to AttendanceCalendar component
   - Mobile: calendar takes full width
   - Desktop: calendar on left, details on right

Calendar day rendering:
```tsx
<div className={cn(
  "aspect-square p-1 text-center text-sm",
  "touch-manipulation", // Better touch handling
  status === 'PRESENT' && "bg-green-100 text-green-800",
  status === 'ABSENT' && "bg-red-100 text-red-800",
  status === 'HALF_DAY' && "bg-yellow-100 text-yellow-800",
  status === 'ON_LEAVE' && "bg-blue-100 text-blue-800",
)}>
  {day}
</div>
```

Summary card:
```tsx
<div className="grid grid-cols-2 gap-4 md:grid-cols-4">
  <StatCard label="Present" value={presentCount} color="green" />
  <StatCard label="Absent" value={absentCount} color="red" />
  <StatCard label="Leave" value={leaveCount} color="blue" />
  <StatCard label="Half-day" value={halfDayCount} color="yellow" />
</div>
```
  </action>
  <verify>`pnpm tsc --noEmit` passes</verify>
  <done>Attendance calendar displays with day details</done>
</task>

<task type="auto">
  <name>Task 2: Create leave dashboard and application pages</name>
  <files>src/app/(employee)/leave/page.tsx, src/app/(employee)/leave/apply/page.tsx, src/components/employee/leave-balance-cards.tsx, src/components/employee/leave-request-form.tsx</files>
  <action>
1. Create `src/components/employee/leave-balance-cards.tsx`:
   - Client component
   - Props: { balances: LeaveBalance[] }
   - Card for each leave type showing:
     - Leave type name (CL, SL, EL)
     - Available balance (large number)
     - Used / Total breakdown
     - Visual progress bar
   - Mobile: stacked cards, full width
   - Desktop: 2-3 column grid

2. Create `src/components/employee/leave-request-form.tsx`:
   - Client component using React Hook Form + Zod
   - Install if needed: `pnpm add react-hook-form @hookform/resolvers`
   - Form fields:
     - Leave type dropdown (from leave types API)
     - Start date picker
     - End date picker
     - Half-day toggle (with First/Second half selector)
     - Reason textarea
   - Real-time validation:
     - Show calculated days count as user picks dates
     - Show available balance
     - Validate balance >= requested days
     - Show warning if insufficient balance
   - Submit to POST /api/leave-requests
   - Show success toast or error message

3. Create `src/app/(employee)/leave/page.tsx`:
   - Server component
   - Fetch leave balances for employee
   - Fetch recent leave requests (last 10)
   - Layout:
     - Balance cards at top
     - "Apply Leave" button (link to /leave/apply)
     - Recent requests list below
   - Mobile: vertical stack
   - Desktop: balances left, requests right

4. Create `src/app/(employee)/leave/apply/page.tsx`:
   - Server component wrapper
   - Fetch leave types for dropdown
   - Fetch current balances for validation
   - Render LeaveRequestForm as client component

Form validation with Zod:
```typescript
const leaveFormSchema = z.object({
  leaveTypeId: z.string().min(1, 'Select leave type'),
  startDate: z.string().min(1, 'Select start date'),
  endDate: z.string().min(1, 'Select end date'),
  isHalfDay: z.boolean(),
  halfDayPeriod: z.enum(['FIRST_HALF', 'SECOND_HALF']).optional(),
  reason: z.string().min(10, 'Please provide a detailed reason'),
}).refine(data => new Date(data.endDate) >= new Date(data.startDate), {
  message: 'End date must be after start date',
  path: ['endDate'],
});
```
  </action>
  <verify>
1. `pnpm tsc --noEmit` passes
2. Visit /leave shows balances and requests
3. Visit /leave/apply shows form
  </verify>
  <done>Leave balances display and application form works with validation</done>
</task>

</tasks>

<verification>
1. `pnpm tsc --noEmit` passes
2. Attendance calendar shows color-coded days
3. Leave balance cards show available/used breakdown
4. Leave form validates dates and balance in real-time
5. Form submits successfully to API
</verification>

<success_criteria>
- Attendance calendar displays with color coding
- Monthly summary shows counts
- Leave balance cards show all leave types
- Leave form validates balance in real-time
- Calculated days shown before submit
- Successful submission shows feedback
</success_criteria>

<output>
After completion, create `.planning/phases/04-employee-self-service/04-05-SUMMARY.md`
</output>
